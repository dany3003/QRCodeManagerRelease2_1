
@using Microsoft.AspNetCore.Identity
@inject UserManager<QRCodeManagerRelease2.Models.ApplicationUser> UserManager

@{
    ViewData["Title"] = "Dashboard";
    var currentUser = await UserManager.GetUserAsync(User);
    var hasQRCodes = ViewBag.HasQRCodes as bool? ?? false;
}

<div class="container-fluid">
    @if (currentUser?.Company?.LogoPath != null)
    {
        <div class="row mb-3">
            <div class="col-12 text-end">
                <img src="@currentUser.Company.LogoPath" alt="Logo Azienda" style="max-height: 60px;">
            </div>
        </div>
    }
    
    <div class="row">
        <div class="col-12">
            <h1>Dashboard - Benvenuto @currentUser?.FirstName</h1>
        </div>
    </div>

    @if (!currentUser.IsAzienda && currentUser.NomeAzienda == null)
    {
        <!-- Dashboard per utenti privati -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="alert alert-info">
                    <h4><i class="fas fa-info-circle"></i> Servizio in Sviluppo</h4>
                    <p class="mb-0">Attualmente i clienti di tipo privato sono in work in progress. 
                    Ti contatteremo non appena il servizio sarà disponibile.</p>
                </div>
            </div>
        </div>
    }
    else if (!currentUser.Abilitato || currentUser.CompanyId == null)
    {
        <!-- Dashboard per aziende non ancora abilitate -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="alert alert-warning">
                    <h4><i class="fas fa-clock"></i> Account in Attesa di Attivazione</h4>
                    <p class="mb-0">Un utente SigiltecH provvederà ad aggiornare l'anagrafica per consentire l'accesso al più presto. 
                    Riceverai una notifica via email quando il tuo account sarà attivo.</p>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- Dashboard completa per aziende abilitate -->
        <div class="row mt-4">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-qrcode"></i>
                            Assegna QR Code
                        </h5>
                        <p class="card-text">Crea e assegna nuovi QR code.</p>
                        <a asp-controller="QRCode" asp-action="Assign" class="btn btn-primary">Assegna QR Code</a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-link"></i>
                            Associazioni
                        </h5>
                        <p class="card-text">Gestisci le associazioni QR-Link.</p>
                        <a asp-controller="Associations" asp-action="Index" class="btn btn-primary">Visualizza Associazioni</a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-chart-bar"></i>
                            Statistiche
                        </h5>
                        <p class="card-text">Visualizza le tue statistiche.</p>
                        <a asp-controller="Statistics" asp-action="Index" class="btn btn-primary">Visualizza Statistiche</a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-user-cog"></i>
                            Profilo
                        </h5>
                        <p class="card-text">Gestisci il tuo profilo.</p>
                        @* <a asp-area="Identity" asp-page="/Account/Manage/Index" class="btn btn-primary">Gestisci Profilo</a> *@
                        <a asp-controller="Account" asp-action="Profile" class="btn btn-primary">Gestisci Profilo</a>

                    </div>
                </div>
            </div>
        </div>
        
        @if (hasQRCodes)
        {
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>Attività Recente</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted">Qui verranno mostrate le attività recenti sui tuoi QR Code.</p>
                        </div>
                    </div>
                </div>
            </div>
        }
    }
</div>
