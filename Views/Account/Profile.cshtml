
@using Microsoft.AspNetCore.Identity
@inject UserManager<QRCodeManagerRelease2.Models.ApplicationUser> UserManager

@{
    ViewData["Title"] = "Gestione Profilo";
    var currentUser = await UserManager.GetUserAsync(User);
}

<div class="container">
    <div class="row">
        <div class="col-md-8">
            <h2>Gestione Profilo</h2>
            
            <form method="post" asp-action="UpdateProfile" enctype="multipart/form-data">
                <div class="card">
                    <div class="card-header">
                        <h5>Informazioni Personali</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="FirstName" class="form-label">Nome</label>
                                    <input type="text" class="form-control" name="FirstName" value="@currentUser?.FirstName" required />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="LastName" class="form-label">Cognome</label>
                                    <input type="text" class="form-control" name="LastName" value="@currentUser?.LastName" required />
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="Email" class="form-label">Email</label>
                            <input type="email" class="form-control" name="Email" value="@currentUser?.Email" required />
                        </div>
                        
                        <div class="mb-3">
                            <label for="Telefono" class="form-label">Telefono</label>
                            <input type="text" class="form-control" name="Telefono" value="@currentUser?.Telefono" />
                        </div>
                    </div>
                </div>
                
                @if (currentUser?.IsAzienda == true)
                {
                    <div class="card mt-3">
                        <div class="card-header">
                            <h5>Informazioni Azienda</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="NomeAzienda" class="form-label">Nome Azienda</label>
                                <input type="text" class="form-control" name="NomeAzienda" value="@currentUser?.NomeAzienda" />
                            </div>
                            
                            <div class="mb-3">
                                <label for="Via" class="form-label">Indirizzo</label>
                                <input type="text" class="form-control" name="Via" value="@currentUser?.Via" />
                            </div>
                            
                            <div class="mb-3">
                                <label for="PartitaIva" class="form-label">Partita IVA</label>
                                <input type="text" class="form-control" name="PartitaIva" value="@currentUser?.PartitaIva" />
                            </div>
                            
                            <div class="mb-3">
                                <label for="Note" class="form-label">Note</label>
                                <textarea class="form-control" name="Note" rows="3">@currentUser?.Note</textarea>
                            </div>
                        </div>
                    </div>
                }
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h5>Sicurezza</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="CurrentPassword" class="form-label">Password Attuale</label>
                            <input type="password" class="form-control" name="CurrentPassword" />
                        </div>
                        
                        <div class="mb-3">
                            <label for="NewPassword" class="form-label">Nuova Password</label>
                            <input type="password" class="form-control" name="NewPassword" />
                        </div>
                        
                        <div class="mb-3">
                            <label for="ConfirmPassword" class="form-label">Conferma Nuova Password</label>
                            <input type="password" class="form-control" name="ConfirmPassword" />
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <button type="submit" class="btn btn-primary">Salva Modifiche</button>
                    <a href="@Url.Action("Dashboard", "Home")" class="btn btn-secondary">Annulla</a>
                </div>
            </form>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>Informazioni Account</h5>
                </div>
                <div class="card-body">
                    <p><strong>Data Registrazione:</strong><br>@currentUser?.DataRegistrazione.ToString("dd/MM/yyyy")</p>
                    <p><strong>Stato:</strong><br>
                        <span class="badge @(currentUser?.Abilitato == true ? "bg-success" : "bg-warning")">
                            @(currentUser?.Abilitato == true ? "Abilitato" : "In Attesa")
                        </span>
                    </p>
                    @if (currentUser?.Company != null)
                    {
                        <p><strong>Azienda Associata:</strong><br>@currentUser.Company.RagioneSociale</p>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
